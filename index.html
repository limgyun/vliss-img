<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cloudflare 自动识别图片轮播</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: #f0f0f0; padding: 20px; }
    .carousel-container { width: 100%; max-width: 800px; height: 450px; overflow: hidden; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.15); }
    .carousel-slides { position: relative; width: 100%; height: 100%; }
    .carousel-slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity 0.8s ease; z-index: 1; }
    .carousel-slide.active { opacity: 1; z-index: 2; }
    .carousel-slide img { width: 100%; height: 100%; object-fit: cover; }
    .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666; font-size: 18px; }
    @media (max-width: 768px) { .carousel-container { height: 300px; } }
    @media (max-width: 480px) { .carousel-container { height: 220px; } }
  </style>
</head>
<body>
  <div class="carousel-container">
    <div class="carousel-slides">
      <div class="loading">加载图片中...</div>
    </div>
  </div>

  <script>
    // 轮播核心变量
    let slides = [];
    let totalSlides = 0;
    let currentIndex = 0;

    // 调用 Cloudflare Pages Functions 接口，获取图片列表
    async function fetchImages() {
      try {
        // 接口地址：/get-images（和 functions/get-images.js 对应）
        const response = await fetch('/get-images');
        const data = await response.json();
        
        if (!data.success) throw new Error(data.message);
        return data.images; // 返回图片文件名列表（如 ["slide1.jpg", "slide2.png"]）
      } catch (error) {
        console.error(error);
        document.querySelector('.loading').textContent = "图片加载失败";
        return [];
      }
    }

    // 动态生成轮播标签（图片从 Cloudflare 加载）
    async function renderCarousel() {
      const imageFiles = await fetchImages();
      const slidesContainer = document.querySelector('.carousel-slides');
      slidesContainer.innerHTML = "";

      if (imageFiles.length === 0) {
        slidesContainer.innerHTML = '<div class="loading">images 文件夹中未找到图片</div>';
        return;
      }

      // 自动生成轮播标签，图片路径：/images/文件名（Cloudflare CDN 加载）
      imageFiles.forEach((fileName, index) => {
        const slideDiv = document.createElement('div');
        slideDiv.className = `carousel-slide ${index === 0 ? 'active' : ''}`;
        const imageUrl = `./images/${fileName}`; // Cloudflare 托管的图片路径
        slideDiv.innerHTML = `<img src="${imageUrl}" alt="图片${index + 1}" loading="lazy">`;
        slidesContainer.appendChild(slideDiv);
      });

      slides = document.querySelectorAll('.carousel-slide');
      totalSlides = slides.length;
      startCarousel();
    }

    // 5秒自动切换
    function startCarousel() {
      if (totalSlides <= 1) return;

      setInterval(() => {
        slides[currentIndex].classList.remove('active');
        currentIndex = (currentIndex + 1) % totalSlides;
        slides[currentIndex].classList.add('active');
      }, 5000);
    }

    document.addEventListener('DOMContentLoaded', renderCarousel);
  </script>
</body>
</html>